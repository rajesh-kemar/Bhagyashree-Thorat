<div class="trip-page">

  <div class="trip-page">

  <!-- Filters + Create Trip button -->
  <div class="list-header">
    <h2>Trips</h2>
    <div class="filters">
      <button (click)="filterTrips('all')" [class.active]="currentFilter==='all'">All</button>
      <button (click)="filterTrips('active')" [class.active]="currentFilter==='active'">Active</button>
      <button (click)="filterTrips('completed')" [class.active]="currentFilter==='completed'">Completed</button>
      <button (click)="filterTrips('long')" [class.active]="currentFilter==='long'">> 8 hours</button>

      <!-- ✅ Create Trip toggle button -->
      <button class="create-trip-btn" (click)="toggleCreateForm()">
        {{ showCreateForm ? 'Cancel' : 'Create Trip' }}
      </button>
    </div>
  </div>

  <!-- ✅ Compact Create Trip Form (Show only when toggled) -->
  <div *ngIf="showCreateForm" class="add-form">
    <h3>Create Trip</h3>

    <form [formGroup]="tripForm" (ngSubmit)="addTrip()">

      <select formControlName="driverId" required>
        <option value="">Select Driver</option>
        <option *ngFor="let d of drivers" [value]="d.driverId">{{ d.name }}</option>
      </select>

      <select formControlName="vehicleId" required>
        <option value="">Select Vehicle</option>
        <option *ngFor="let v of vehicles" [value]="v.vehicleId">
          {{ v.numberPlate }} ({{ v.type }})
        </option>
      </select>

      <input formControlName="source" type="text" placeholder="Source" required />
      <input formControlName="destination" type="text" placeholder="Destination" required />
      <input formControlName="startTime" type="datetime-local" required />

      <button type="submit" [disabled]="tripForm.invalid">Save Trip</button>
    </form>

    <p *ngIf="message" class="message">{{ message }}</p>
  </div>


  <!-- ✅ Trips List Still Below -->
  <div class="trip-list-container">

    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Driver</th>
          <th>Vehicle</th>
          <th>Source</th>
          <th>Destination</th>
          <th>Start</th>
          <th>End</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let trip of filteredTrips; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ trip.driver?.name || 'N/A' }}</td>
          <td>{{ trip.vehicle?.numberPlate || 'N/A' }} ({{ trip.vehicle?.type || 'N/A' }})</td>
          <td>{{ trip.source }}</td>
          <td>{{ trip.destination }}</td>
          <td>{{ trip.startTime | date:'short' }}</td>
          <td>{{ trip.endTime ? (trip.endTime | date:'short') : '—' }}</td>
          <td [ngClass]="trip.status">{{ trip.status }}</td>
          <td>
            <button *ngIf="trip.status !== 'Completed'" class="complete-btn" (click)="completeTrip(trip.tripId)">
              Mark Complete
            </button>
          </td>
        </tr>
      </tbody>

    </table>
  </div>
</div>
